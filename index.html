// =============================
// OUTCOME PROBABILITIES (2012–2013 TOP-100)
// rank_group × pos_type → bucket probabilities
// =============================
const BUCKET_ORDER = ["<$5M", "$5-25M", "$25-75M", "$75-150M", ">$150M"];

// Data-driven from 2012+2013 Top-100
const OUTCOME_PROBS = {
  "1-20": {
    "Hitter":  { "<$5M": 0.1333, "$5-25M": 0.0667, "$25-75M": 0.1333, "$75-150M": 0.2000, ">$150M": 0.4667 },
    "Pitcher": { "<$5M": 0.1429, "$5-25M": 0.2381, "$25-75M": 0.2381, "$75-150M": 0.2381, ">$150M": 0.1429 },
    "Catcher": { "<$5M": 0.2500, "$5-25M": 0.0000, "$25-75M": 0.7500, "$75-150M": 0.0000, ">$150M": 0.0000 }
  },
  "21-50": {
    "Hitter":  { "<$5M": 0.3462, "$5-25M": 0.1923, "$25-75M": 0.1538, "$75-150M": 0.0769, ">$150M": 0.2308 },
    "Pitcher": { "<$5M": 0.2188, "$5-25M": 0.2813, "$25-75M": 0.3750, "$75-150M": 0.0625, ">$150M": 0.0625 },
    "Catcher": { "<$5M": 0.0000, "$5-25M": 0.0000, "$25-75M": 1.0000, "$75-150M": 0.0000, ">$150M": 0.0000 }
  },
  "51-100": {
    "Hitter":  { "<$5M": 0.5854, "$5-25M": 0.0976, "$25-75M": 0.1463, "$75-150M": 0.1220, ">$150M": 0.0488 },
    "Pitcher": { "<$5M": 0.4706, "$5-25M": 0.2353, "$25-75M": 0.1765, "$75-150M": 0.0784, ">$150M": 0.0392 },
    "Catcher": { "<$5M": 0.3750, "$5-25M": 0.1250, "$25-75M": 0.5000, "$75-150M": 0.0000, ">$150M": 0.0000 }
  }
};

// Sample sizes for transparency
const OUTCOME_N = {
  "1-20":  { "Hitter": 15, "Pitcher": 21, "Catcher": 4 },
  "21-50": { "Hitter": 26, "Pitcher": 32, "Catcher": 2 },
  "51-100": { "Hitter": 41, "Pitcher": 51, "Catcher": 8 }
};

// Fallback if a cell is thin/missing (rank_group only)
const OUTCOME_FALLBACK = {
  "1-20":  { "<$5M": 0.1500, "$5-25M": 0.1500, "$25-75M": 0.2500, "$75-150M": 0.2000, ">$150M": 0.2500 },
  "21-50": { "<$5M": 0.2667, "$5-25M": 0.2333, "$25-75M": 0.3333, "$75-150M": 0.0500, ">$150M": 0.1167 },
  "51-100": { "<$5M": 0.5100, "$5-25M": 0.1600, "$25-75M": 0.1900, "$75-150M": 0.0900, ">$150M": 0.0500 }
};

function posTypeFromPosition(position) {
  if (position === "RHP" || position === "LHP") return "Pitcher";
  if (position === "C") return "Catcher";
  return "Hitter";
}

function pct(x) {
  return `${Math.round(x * 100)}%`;
}

function renderOutcomeProbabilities(rankGroup, position) {
  const posType = posTypeFromPosition(position);

  const cell = (OUTCOME_PROBS[rankGroup] && OUTCOME_PROBS[rankGroup][posType]) || null;
  const probs = cell || OUTCOME_FALLBACK[rankGroup];
  const n = (OUTCOME_N[rankGroup] && OUTCOME_N[rankGroup][posType]) || null;

  const tbody = document.getElementById("probBody");
  tbody.innerHTML = "";

  for (const b of BUCKET_ORDER) {
    const p = probs[b] ?? 0;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="fw-semibold">${b}</td>
      <td>${pct(p)}</td>
    `;
    tbody.appendChild(tr);
  }

  const note = document.getElementById("probNote");
  if (cell && n) {
    note.innerText = `Based on 2012–2013 Top-100 comps for ${rankGroup} ${posType} (n=${n}).`;
  } else {
    note.innerText = `Based on 2012–2013 Top-100 comps for rank group ${rankGroup} (fallback).`;
  }
}
